@{
    ViewBag.Title = "Home Page";
}
<script>
    function renderReslut() {
        var htmlText = document.getElementById("htmlText").value;
        var cssText = document.getElementById("cssText").value;
        if (!htmlText)
            return;
        var ifr = document.createElement("iframe");
        ifr.setAttribute("frameborder", "0");
        ifr.setAttribute("id", "iframeResult");
        ifr.setAttribute("name", "iframeResult");
        var wrapper = document.getElementById("wrapper-actual");
        while (wrapper.firstChild) {
            wrapper.removeChild(wrapper.firstChild);
        }

        wrapper.appendChild(ifr);
        var ifrw = (ifr.contentWindow) ? ifr.contentWindow : (ifr.contentDocument.document) ? ifr.contentDocument.document : ifr.contentDocument;
        ifrw.document.open();
        ifrw.document.write(htmlText);

        if (!cssText) {
            ifrw.document.close();
            return;
        }
        var style = ifrw.document.createElement("style");
        style.innerHTML = cssText;
        ifrw.document.head.appendChild(style);
        ifrw.document.close();
    }

    document.addEventListener("DOMContentLoaded", renderReslut);

</script>

<div id="mySidenav" class="sidenav">
    <a id="close" href="javascript:void(0)" class="closebtn">&times;</a>
    <h1>All tasks:</h1>
    @for (int i = 0; i < ViewBag.Tasks.Count; i++)
    {
        <a href='@Url.Action("Index", "Home", new { taskId = ViewBag.Tasks[i].Id })'>@ViewBag.Tasks[i].Name</a>
    }
</div>
<div class="container-fluid" id="container">
    <div class="row sp">
        <div class="na col-md-2">
            <span id="spa">&#9776; Tasks</span>
        </div>
    </div>

    <div class="row task" id="task">
        <div class="col-md-2">
            <p>Instructions</p>
            <p>
                @ViewBag.CurrentTask.Description
            </p>
        </div>

        <div class="ma col-md-5 text-center">          
            @using (Html.BeginForm("Verify", "Home", new { taskId = ViewBag.CurrentTask.Id }, FormMethod.Post))
            {
                <div id="tab">
                    <ul class="nav nav-pills">
                        <li class="active">
                            <a href="#html" data-toggle="tab">index.html</a>
                        </li>
                        <li>
                            <a href="#css" data-toggle="tab">style.css</a>
                        </li>
                    </ul>

                    <div class="tab-content clearfix">
                        <div class="tab-pane active" id="html">
                            <textarea name="htmlCode" id="htmlText" cols="10" rows="10" onchange="renderReslut()" onkeyup="renderReslut()">@if (ViewBag.PreviousHtmlCode != null){@ViewBag.PreviousHtmlCode}</textarea>
                        </div>
                        <div class="tab-pane" id="css">
                            <textarea name="cssCode" id="cssText" cols="30" rows="10" onchange="renderReslut()" onkeyup="renderReslut()">@if (ViewBag.PreviousCssCode != null){@ViewBag.PreviousCssCode}</textarea>
                        </div>
                    </div>
                </div>
                <div style="background-color:white">
                    <div class="row">
                        <div class="col-md-4 col-lg-3">                            
                            <button type="submit" id="sub" class="panel-body btn btn-primary btn-lg" style="width:100%;border-radius:0;">
                                <span class="glyphicon glyphicon-ok"></span> Submit
                            </button>
                        </div>
                        <div class="col-md-4 col-lg-6 text-center" style="margin-top:15px;margin-bottom:15px">                            
                            @if (ViewBag.TaskResult == "Correct")
                            {
                                <span class="text-success">Правильно</span>
                            }
                            @if (ViewBag.TaskResult == "Incorrect")
                            {
                                <span class="text-danger">Неправильно</span>
                            }                            
                        </div>
                        <div class="col-md-4 col-lg-3">                  
                            @if (ViewBag.TaskResult == "Correct")
                            {
                                <button type="button" class="panel-body btn btn-info btn-lg" style="width:100%;border-radius:0;" onclick="location.href='@Url.Action("NextTask", "Home", new { taskId = ViewBag.CurrentTask.Id })'">
                                    <span class="glyphicon glyphicon-circle-arrow-right"></span> Next
                                </button>
                            }
                            else
                            {
                                <button type="button" class="panel-body btn btn-info btn-lg pull-right disabled" style="width:100%;border-radius:0;">
                                    <span class="glyphicon glyphicon-circle-arrow-right"></span> Next
                                </button>
                            }
                        </div>
                    </div>
                </div>               
            }
        </div>

        <div class="col-md-5">
            <div id="tab">
                <ul class="nav nav-pills">
                    <li class="active">
                        <a href="#actual" data-toggle="tab">Actual result</a>
                    </li>
                    <li>
                        <a href="#expect" data-toggle="tab">Expected result</a>
                    </li>
                </ul>

                <div class="tab-content clearfix">
                    <div class="tab-pane active" id="actual">
                        <div id="wrapper-actual">
@*                            @if (ViewBag.InlinedCode != null)*@
@*                            {*@
@*                                var str = new HtmlString(ViewBag.InlinedCode);*@
@*                                <div class="section" id="contentContainer">*@
@*                                    @str*@
@*                                </div>*@
@*                            }*@
                        </div>
                    </div>
                    <div class="tab-pane" id="expect">
                        <div id="wrapper-expected">Expected result</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>